  {% load static tailwind_tags %}
  {% load static %}
  {% load forum_tags %}
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock title %}</title>
    {% tailwind_css %}
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'style.css' %}">
  </head>
  <body>
    <nav class="relative bg-gray-800/50 after:pointer-events-none after:absolute after:inset-x-0 after:bottom-0 after:h-px after:bg-white/10">
      <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-center">
          
          <!-- search form -->
          <form action="{% url "forum:search" %}" method="get" class="w-full sm:max-w-md mx-auto px-2">
            {% csrf_token %}
            <div class="relative">
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none z-10">
                <svg class="w-4 h-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" 
                  viewBox="0 0 20 20">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                </svg>
              </div>
              <input type="search" name="q" id="default-search"
                class="block w-full pl-10 pr-24 py-2 text-sm text-gray-400 border border-gray-600 rounded-lg bg-gray-800/50 placeholder-gray-400 transition-all duration-200 hover:shadow-md hover:shadow-gray-500/50 focus:ring-1 focus:ring-gray-500/50 focus:outline-none"
                placeholder="Search posts..." / required>
              <button type="submit"
                class="absolute right-1 bottom-1 text-gray-300 hover:text-white rounded-lg transition-all duration-200 px-2.5 py-1">
                Search
              </button>
            </div>
          </form>
        </div>
      </div>
    </nav>

    <main role="main" class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">

      <button id="menu-toggle"
        class="absolute left-3 top-1/2 -translate-y-1/2 block lg:hidden text-gray-300 hover:text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <!-- mobile menu -->
      <div id="mobile-menu" class="lg:hidden hidden fixed inset-0 bg-gray-900/95 z-50 overflow-y-auto">
        <div class="p-6 space-y-4 border-b border-white/10">
          <button id="close-menu" class="text-gray-300 hover:text-white mb-4">âœ• Close</button>

          <h3 class="text-lg font-medium text-gray-300 mb-3">Navigation</h3>
          <ul class="space-y-2">
            <li><a href="{% url 'forum:post_feed' %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Home</a></li>
            {% if request.user.is_authenticated %}
            <li><a href="{% url "forum:profile_page" request.user.id %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Profile</a></li>
            {% endif %}
            
            {% if not request.user.is_authenticated %}
              <li><a href="{% url "users:login" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Log In</a></li>
              <li><a href="{% url "users:register" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Register</a></li>
            {% else %}
              <li><a href="{% url "users:logging_out" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Log Out</a></li>
            {% endif %}
            <li><a href="{% url "forum:create_post" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">+ Create</a></li>
          </ul>
        </div>
      </div>

      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Left Sidebar -->
        <aside class="hidden lg:block w-64 bg-gray-800/50 p-4 hover:shadow-[0_10px_20px_rgba(250,250,250,0.2)] transition duration-300 ease-in-out">
          <h3 class="text-lg font-medium text-gray-300 mb-3 px-3">Navigation</h3>
          <ul class="space-y-2 px-3">
            <li>
              <a href="{% url 'forum:post_feed' %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Home</a>
            </li>
            {% if request.user.is_authenticated %}
            <li>
              <a href="{% url "forum:profile_page" request.user.id %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Profile</a>
            </li>
            {% endif %}
            
            {% if not request.user.is_authenticated %}
              <li>
                <a href="{% url "users:login" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Log In</a>
              </li>
              <li>
                <a href="{% url "users:register" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Register</a>
              </li>
            {% else %}
              <li>
                <a href="{% url "users:logging_out" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">Log Out</a>
              </li>
            {% endif %}
            <li>
              <a href="{% url "forum:create_post" %}" class="block rounded-md px-3 py-2 text-sm text-gray-300 hover:bg-white/5 hover:text-white">+ Create</a>
            </li>
          </ul>

          <div class="mt-6 pt-4 border-t border-white/10 ">
            <h3 class="text-lg font-medium text-gray-300 mb-3 px-3">Trending</h3>
            {% get_most_popular_tags as tags %}
              <div class="space-y-3 px-3">
              <div class="text-sm text-gray-400 px-3">
                {% for tag in tags %}
                  <a class="font-medium text-gray-300 dark:hover:text-indigo-500 transition-colors break-all" href="{% url "forum:post_feed_by_slug" tag.slug %}">#{{ tag.name }}</a>
                  {% if tag|count_posts_tagged == 1 %}
                    <div class="mb-2">{{ tag|count_posts_tagged }} post</div>
                  {% else %}
                    <div class="mb-2">{{ tag|count_posts_tagged }} posts</div>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 w-full bg-gray-800/50 p-6 hover:shadow-[0_10px_20px_rgba(250,250,250,0.2)] transition duration-300 ease-in-out">
          {% block content %}{% endblock content %}
        </div>

        <!-- Right Sidebar -->
        <aside class="hidden lg:block w-64 bg-gray-800/50 p-4 hover:shadow-[0_10px_20px_rgba(250,250,250,0.2)] transition duration-300 ease-in-out">
          <h3 class="text-lg font-medium text-gray-300 mb-3 px-3">Most liked posts</h3>
          {% get_most_liked_posts as posts %}
          <div class="space-y-3">
            <div class="text-sm px-6">
              {% for post in posts %}
                <a class="font-medium text-gray-300 dark:hover:text-indigo-500 transition-colors break-all" href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                {% if post|count_likes_post == 1 %}
                  <div class="text-gray-400 mb-2">{{ post|count_likes_post }} like</div>
                {% else %}
                  <div class="text-gray-400 mb-2">{{ post|count_likes_post }} likes</div>
                {% endif %}
              {% endfor %}
            </div>
          </div>

          <div class="mt-6 pt-4 border-t border-white/10">
            <h3 class="text-lg font-medium text-gray-300 mb-3 px-3">Most commented posts</h3>
          {% get_most_commented_posts as posts %}
          <div class="space-y-3">
            <div class="text-sm px-6">
              {% for post in posts %}
                <a class="font-medium text-gray-300 dark:hover:text-indigo-500 transition-colors break-all" href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                {% if post|count_comments_post == 1 %}
                  <div class="text-gray-400 mb-2">{{ post|count_comments_post }} comment</div>
                {% else %}
                  <div class="text-gray-400 mb-2">{{ post|count_comments_post }} comments</div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
          </div>
        </aside>
      </div>
    </main>
    <script>
      // save Y position after like button was clicked
      document.addEventListener("DOMContentLoaded", () => {
        const likeButtons = document.querySelectorAll(".like-button");

        likeButtons.forEach(button => {
          button.addEventListener("click", (event) => {
            localStorage.setItem("scrollY", window.scrollY);
          });
        });

        const scrollY = localStorage.getItem("scrollY");
        if (scrollY !== null) {
          window.scrollTo(0, parseInt(scrollY));
          localStorage.removeItem("scrollY");
        }
      });
    </script>
    <script>
      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const closeMenu = document.getElementById('close-menu');

      menuToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });

      closeMenu.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
      });
    </script>
  </body>
  </html>